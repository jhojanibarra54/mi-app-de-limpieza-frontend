import{a as d}from"./chunk-HEXEI4CB.js";import{A as m,a as o,c,f as u,i as h,j as p,k as a,w as f}from"./chunk-BKGTBVKK.js";import{g as i}from"./chunk-2R6CW7ES.js";var s=d("Preferences",{web:()=>import("./chunk-QYWDKBEU.js").then(n=>new n.PreferencesWeb)});var l="my-auth-token",O=(()=>{let e=class e{constructor(){this.isAuthenticated=new o(null),this.currentUserRole=new o(null),this.http=a(f),this.router=a(m),this.apiUrl="http://localhost/php-api/api/auth/login.php",this.loadToken()}loadToken(){return i(this,null,function*(){let r=yield s.get({key:l});if(r&&r.value){let t=JSON.parse(r.value);this.isAuthenticated.next(!0),this.currentUserRole.next(t.user.role)}else this.isAuthenticated.next(!1),this.currentUserRole.next(null)})}getIsAuthenticated(){return this.isAuthenticated.asObservable()}getCurrentUserRole(){return this.currentUserRole.asObservable()}login(r){return this.http.post(this.apiUrl,r).pipe(h(t=>i(this,null,function*(){yield s.set({key:l,value:JSON.stringify(t)}),this.isAuthenticated.next(!0),this.currentUserRole.next(t.user.role)})),u(t=>(this.isAuthenticated.next(!1),this.currentUserRole.next(null),c(()=>t))))}logout(){return i(this,null,function*(){yield s.remove({key:l}),this.isAuthenticated.next(!1),this.currentUserRole.next(null),this.router.navigateByUrl("/welcome",{replaceUrl:!0})})}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{O as a};
